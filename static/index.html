<!DOCTYPE html>
<html>
    <head>
        <title>hallelujah input method on web</title>
        <link rel="stylesheet" type="text/css" href="/awesomplete.css" />
        <style>
            #webim {
                display: inline-block;
                width: 600px;
                height: 50px;
                vertical-align: top;
                padding: 5px;
            }
        </style>
    </head>
    <body>
        <input type="text" id='webim'>

        <script src='/awesomplete.js'></script>
        <script src="/jquery-2.2.1.min.js"></script>

        <script>
            void function(){
                if ("WebSocket" in window) {
                    var ws = new WebSocket("ws://127.0.0.1:3001");
                    
                    var awesomplete, oInput = $('#webim');
                    ws.onopen = function() {
                        console.log("websocket connected!");
                        
                        awesomplete = new Awesomplete(oInput[0], {
                            minChars: 1, 
                            autoFirst: true,
                            filter: function (item, input) {
                                var arr = input.trim().split(' ');
                                var lastWord = arr[arr.length - 1];
                                return item.value.indexOf(lastWord) === 0;
                            },
                            replace: function (text) {
                                var arr = this.input.value.trim().split(' ');
                                arr.pop();
                                arr.push(text);
                                this.input.value = arr.join(' ') + ' ';
                            },
                            sort: false
                        });   

                        oInput.on('input', function(){
                            var arr = this.value.trim().split(' ');
                            var lastWord = arr[arr.length - 1];
                            if (lastWord.length > 0) {
                                ws.send(lastWord);
                            } else {
                                awesomplete.list = [];
                            }
                        });
                    };
                    ws.onmessage = function (evt) {
                        awesomplete.list = JSON.parse(evt.data);
                    };
                    ws.onclose = function() {
                        console.log("websocket closed");
                    };
                }
            }();
        </script>
    </body>
</html>