<!DOCTYPE html>
<html>
    <head>
        <title>hallelujah input method on web</title>
        <link rel="stylesheet" type="text/css" href="/richAutocomplete.min.css" />
        <style>
            #webim {
                display: inline-block;
                width: 600px;
                height: 300px;
            }

            .candidates {
                width: 600px;
            }
        </style>
    </head>
    <body>
        <input type="text" id='webim'>
        <div class="candidates"></div>

        <script src="/jquery-2.2.1.min.js" integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00=" crossorigin="anonymous"></script>
        <script src="/jquery.richAutocomplete.min.js" type="text/javascript"></script>
        <script>
            void function(){
                if ("WebSocket" in window) {
                    var ws = new WebSocket("ws://127.0.0.1:3001");

                    ws.onopen = function() {
                        console.log("websocket connected!");

                        $('#webim').on('input keyup', function(){
                            console.log(this.value);
                            ws.send(this.value);
                        });
                    };
                    ws.onmessage = function (evt) {
                        var data = evt.data;
                        $('.candidates').text(JSON.parse(data).join(' '));
                        console.log(evt.data);
                    };
                    ws.onclose = function() {
                        console.log("websocket closed");
                        window.location.reload(true);
                    };
                }
            }();
        </script>
    </body>
</html>